<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
    
    * { font-family: 'Tajawal', sans-serif; box-sizing: border-box; }
    
    .card { transition: all 0.3s ease; cursor: pointer; }
    .card:hover { transform: translateY(-8px) scale(1.05); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    .card.flipped { animation: flip 0.6s ease; }
    
    @keyframes flip {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }
    
    .balloon { animation: float 3s ease-in-out infinite; display: inline-block; }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }

    .level-badge { animation: pulse 2s ease-in-out infinite; transition: all 0.3s ease; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
  </style>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto"></div>
  <script>
    const defaultConfig = {
      app_title: "ğŸ® ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ğŸ®",
      game_instruction: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ø³Ù…Ø§Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡!",
      background_color: "#FFE5F1",
      card_color: "#FFFFFF",
      primary_color: "#FF6B9D",
      secondary_color: "#4ECDC4",
      text_color: "#2C3E50"
    };

    const namesLevel1 = [
      { name: "Ù…ÙƒÙŠ", emoji: "ğŸŒ¸", color: "#FF6B9D" },
      { name: "Ø³Ø§Ø±Ø©", emoji: "ğŸŒº", color: "#FFB6C1" },
      { name: "Ø£Ø­Ù…Ø¯", emoji: "âš½", color: "#4ECDC4" },
      { name: "Ù„Ø§Ù†Ø§", emoji: "ğŸ¦‹", color: "#9B59B6" },
      { name: "Ø±Ù†Ø§", emoji: "ğŸŒŸ", color: "#F39C12" },
      { name: "Ø²ÙŠÙ†Ø¨", emoji: "ğŸŒ·", color: "#E74C3C" },
      { name: "Ù…Ø­Ù…Ø¯", emoji: "ğŸš€", color: "#3498DB" },
      { name: "Ø­Ø³Ø§Ù…", emoji: "âš¡", color: "#2ECC71" },
      { name: "Ø±Ø²Ø§Ù†", emoji: "ğŸ¨", color: "#E67E22" },
      { name: "Ø±Ù†Ø§Ø¯", emoji: "ğŸµ", color: "#1ABC9C" },
      { name: "Ø¢ÙŠØ©", emoji: "ğŸ“š", color: "#9B59B6" },
      { name: "Ù…Ø§ÙŠØ§", emoji: "ğŸŒˆ", color: "#FF6B9D" },
      { name: "ÙŠØ§Ø±Ø§", emoji: "ğŸ€", color: "#FFB6C1" },
      { name: "Ø¥ÙŠØ§Ø¯", emoji: "ğŸª", color: "#F39C12" },
      { name: "ÙØ§Ø±Ø³", emoji: "ğŸ¯", color: "#E74C3C" },
      { name: "ÙŠØ§Ø³Ù…ÙŠÙ†", emoji: "ğŸŒ»", color: "#2ECC71" }
    ];

    const namesLevel2 = [
      { name: "ÙˆØ§Ø«Ù‚", emoji: "ğŸ’ª", color: "#FF6B9D" },
      { name: "Ù‡Ù†Ø§Ø¡", emoji: "ğŸ˜Š", color: "#FFB6C1" },
      { name: "Ø³Ù…Ø§Ø­", emoji: "ğŸŒ™", color: "#4ECDC4" },
      { name: "Ø³Ù‡ÙŠØ±", emoji: "âœ¨", color: "#9B59B6" },
      { name: "Ø³Ø­Ø±", emoji: "ğŸ­", color: "#F39C12" },
      { name: "Ù†Ø§Ø¯Ø±", emoji: "ğŸ’", color: "#E74C3C" },
      { name: "Ø±ÙŠÙ…", emoji: "ğŸ¦Œ", color: "#3498DB" },
      { name: "Ø¹Ù…Ø±", emoji: "ğŸƒ", color: "#2ECC71" },
      { name: "Ù‡Ø´Ø§Ù…", emoji: "ğŸ“", color: "#E67E22" },
      { name: "Ø¹ØµÙ…Øª", emoji: "ğŸ›¡ï¸", color: "#1ABC9C" },
      { name: "Ù…Ø§Ù„Ùƒ", emoji: "ğŸ‘‘", color: "#9B59B6" },
      { name: "ÙŠØ§Ø³ÙŠÙ†", emoji: "ğŸ•Œ", color: "#FF6B9D" },
      { name: "Ø£ÙŠÙ…Ù†", emoji: "ğŸŒŸ", color: "#FFB6C1" },
      { name: "Ø²ÙŠÙ†", emoji: "ğŸ¨", color: "#F39C12" },
      { name: "Ø²ÙŠØ§Ø¯", emoji: "ğŸš´", color: "#E74C3C" },
      { name: "Ø¹Ø¯Ù†", emoji: "ğŸŒŠ", color: "#2ECC71" }
    ];

    let currentLevel = 1;
    let currentMode = 'cards';
    let score = 0;
    let matchesFound = 0;
    let firstCard = null;
    let lockBoard = false;
    let memoryPairs = [];

    function getConfig() {
      return window.elementSdk?.config || defaultConfig;
    }

    function getCurrentNames() {
      return currentLevel === 1 ? namesLevel1 : namesLevel2;
    }

    function speakName(name) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(name);
        utterance.lang = 'ar-SA';
        utterance.rate = 0.9;
        speechSynthesis.speak(utterance);
      }
    }

    function shuffleArray(array) {
      return [...array].sort(() => Math.random() - 0.5);
    }

    window.switchLevel = function(lvl) {
      currentLevel = lvl;
      if (currentMode === 'memory') initializeMemoryGame();
      render();
    };

    window.switchMode = function(mode) {
      currentMode = mode;
      firstCard = null;
      lockBoard = false;
      if (mode === 'memory') initializeMemoryGame();
      render();
    };

    function initializeMemoryGame() {
      const names = shuffleArray(getCurrentNames().slice(0, 8));
      memoryPairs = shuffleArray([...names, ...names]);
      matchesFound = 0;
    }

    function renderLevelButtons() {
      const config = getConfig();
      return `
        <div class="flex justify-center gap-4 mb-6">
          <button style="background: ${currentLevel === 1 ? config.primary_color : config.secondary_color};"
            class="level-badge px-6 py-3 rounded-full text-xl font-black shadow-lg text-white" onclick="switchLevel(1)">ğŸ¥‡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</button>
          <button style="background: ${currentLevel === 2 ? config.primary_color : config.secondary_color};"
            class="level-badge px-6 py-3 rounded-full text-xl font-black shadow-lg text-white" onclick="switchLevel(2)">ğŸ¥ˆ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2</button>
        </div>`;
    }

    function renderGameModeButtons() {
      const config = getConfig();
      return `
        <div class="flex justify-center gap-4 flex-wrap mb-8">
          <button style="background: ${currentMode === 'cards' ? config.primary_color : config.secondary_color};"
            class="px-6 py-3 rounded-full text-xl font-black shadow-lg text-white" onclick="switchMode('cards')">ğŸƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</button>
          <button style="background: ${currentMode === 'memory' ? config.primary_color : config.secondary_color};"
            class="px-6 py-3 rounded-full text-xl font-black shadow-lg text-white" onclick="switchMode('memory')">ğŸ§  Ø§Ù„Ø°Ø§ÙƒØ±Ø©</button>
          <button style="background: ${currentMode === 'quiz' ? config.primary_color : config.secondary_color};"
            class="px-6 py-3 rounded-full text-xl font-black shadow-lg text-white" onclick="switchMode('quiz')">ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>`;
    }

    function renderCardsMode() {
      const config = getConfig();
      const names = getCurrentNames();
      return `
        <div style="background: ${config.background_color};" class="w-full min-h-full p-6 text-center">
          <h1 style="color: ${config.primary_color};" class="text-5xl font-black mb-4 balloon">${config.app_title}</h1>
          <p style="color: ${config.text_color};" class="text-2xl font-bold mb-6">${config.game_instruction}</p>
          ${renderLevelButtons()}
          ${renderGameModeButtons()}
          <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto">
            ${names.map((item, index) => `
              <div class="card rounded-3xl shadow-lg p-6" style="background: ${config.card_color}; border: 4px solid ${item.color};"
                   onclick="handleCardClick(${index}, this)">
                <div class="text-6xl mb-4">${item.emoji}</div>
                <h3 style="color: ${config.text_color};" class="text-3xl font-black">${item.name}</h3>
              </div>`).join('')}
          </div>
        </div>`;
    }

    function renderMemoryMode() {
      const config = getConfig();
      return `
        <div style="background: ${config.background_color};" class="w-full min-h-full p-6 text-center">
          <h1 style="color: ${config.primary_color};" class="text-5xl font-black mb-4">ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h1>
          <div style="background: ${config.secondary_color};" class="inline-block px-8 py-2 rounded-full mb-6">
            <p style="color: white;" class="text-2xl font-black">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">${score}</span></p>
          </div>
          ${renderLevelButtons()}
          ${renderGameModeButtons()}
          <div class="grid grid-cols-4 gap-4 max-w-4xl mx-auto">
            ${memoryPairs.map((item, index) => `
              <div class="card rounded-2xl shadow-lg h-32 flex items-center justify-center text-5xl text-white" 
                   style="background: ${config.primary_color};"
                   onclick="handleMemoryClick(this, ${index})">â“</div>`).join('')}
          </div>
        </div>`;
    }

    function renderQuizMode() {
      const config = getConfig();
      const names = getCurrentNames();
      const target = names[Math.floor(Math.random() * names.length)];
      const options = shuffleArray([target, ...shuffleArray(names.filter(n => n.name !== target.name)).slice(0, 3)]);

      return `
        <div style="background: ${config.background_color};" class="w-full min-h-full p-6 text-center">
          <h1 style="color: ${config.primary_color};" class="text-5xl font-black mb-4">ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h1>
          <div style="background: ${config.secondary_color};" class="inline-block px-8 py-2 rounded-full mb-6">
            <p style="color: white;" class="text-2xl font-black">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="quiz-score">${score}</span></p>
          </div>
          ${renderLevelButtons()}
          ${renderGameModeButtons()}
          <div style="background: ${config.card_color};" class="max-w-2xl mx-auto rounded-3xl shadow-2xl p-10 border-8 border-white">
            <div class="text-9xl mb-8 balloon">${target.emoji}</div>
            <div class="grid grid-cols-2 gap-4">
              ${options.map(opt => `
                <button style="background: ${config.secondary_color};" 
                  class="py-6 rounded-2xl text-2xl font-black shadow-lg hover:opacity-90 text-white"
                  onclick="handleQuizAnswer('${opt.name}', '${target.name}', this)">${opt.name}</button>`).join('')}
            </div>
            <div id="quiz-feedback" class="mt-8 text-3xl font-black min-h-[3rem]"></div>
          </div>
        </div>`;
    }

    window.handleCardClick = function(index, el) {
      el.classList.add('flipped');
      speakName(getCurrentNames()[index].name);
      setTimeout(() => el.classList.remove('flipped'), 600);
    };

    window.handleMemoryClick = function(el, index) {
      if (lockBoard || el.classList.contains('matched') || el === firstCard) return;
      
      const config = getConfig();
      const item = memoryPairs[index];
      
      el.innerHTML = `<div class="flex flex-col items-center"><span class="text-4xl">${item.emoji}</span><span class="text-sm mt-1">${item.name}</span></div>`;
      el.style.background = config.card_color;
      el.style.color = config.text_color;
      speakName(item.name);

      if (!firstCard) {
        firstCard = el;
        firstCard.dataset.index = index;
        return;
      }

      lockBoard = true;
      const firstItem = memoryPairs[firstCard.dataset.index];
      
      if (firstItem.name === item.name) {
        score += 10;
        matchesFound++;
        el.classList.add('matched');
        firstCard.classList.add('matched');
        document.getElementById('score').textContent = score;
        firstCard = null;
        lockBoard = false;
        if (matchesFound === 8) {
          setTimeout(() => alert("ğŸ‰ Ø±Ø§Ø¦Ø¹! Ù„Ù‚Ø¯ ÙˆØ¬Ø¯Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬! ğŸ‰"), 500);
        }
      } else {
        setTimeout(() => {
          el.innerHTML = "â“"; el.style.background = config.primary_color; el.style.color = "white";
          firstCard.innerHTML = "â“"; firstCard.style.background = config.primary_color; firstCard.style.color = "white";
          firstCard = null; lockBoard = false;
        }, 1000);
      }
    };

    window.handleQuizAnswer = function(selected, correct, btn) {
      const feedback = document.getElementById('quiz-feedback');
      if (selected === correct) {
        btn.style.background = "#2ECC71";
        feedback.innerHTML = "ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©";
        feedback.className = "mt-8 text-3xl font-black text-green-500";
        score += 5;
        document.getElementById('quiz-score').textContent = score;
        speakName(correct);
        setTimeout(render, 1500);
      } else {
        btn.style.background = "#E74C3C";
        feedback.innerHTML = "âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
        feedback.className = "mt-8 text-3xl font-black text-red-500";
        speakName("Ø®Ø·Ø£");
      }
    };

    function render() {
      const app = document.getElementById('app');
      if (currentMode === 'cards') app.innerHTML = renderCardsMode();
      else if (currentMode === 'memory') app.innerHTML = renderMemoryMode();
      else app.innerHTML = renderQuizMode();
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: () => render(),
        mapToCapabilities: (config) => ({
          recolorables: [
            { get: () => config.background_color, set: (v) => { config.background_color = v; window.elementSdk.setConfig(config); } },
            { get: () => config.primary_color, set: (v) => { config.primary_color = v; window.elementSdk.setConfig(config); } }
          ]
        })
      });
    }

    render();
  </script>
 </body>
</html>
